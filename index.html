<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@jackokeeffe</title>
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png">
    <link rel="manifest" href="favicons/site.webmanifest">
    <link rel="shortcut icon" href="favicons/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/nostr-tools@2.3.0/lib/nostr.bundle.min.js"></script>

    <meta name="description" content="student, filmmaker">
    
    <meta name="keywords" content="jack okeeffe, jack o'keeffe, jack o'keefe">
    <meta name="author" content="@jackokeeffe">
    <meta name="robots" content="index, follow">

    <!-- Security Headers -->
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://fonts.googleapis.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self' https://api.github.com https://api.rss2json.com wss:; frame-src 'none'; object-src 'none'; base-uri 'self'; form-action 'self'">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=()">

    <meta property="og:title" content="@jackokeeffe">
    <meta property="og:description" content="student, filmmaker">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jackokeeffe.site">
    <meta property="og:locale" content="en_CA">
    <meta property="og:image" content="https://jackokeeffe.site/images/preview.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="@jackokeeffe">
    <meta name="twitter:description" content="student, filmmaker">
    <meta name="twitter:image" content="https://jackokeeffe.site/images/preview.jpg">
    <meta name="twitter:site" content="@jckokeeffe">

    <link rel="canonical" href="https://jackokeeffe.site/">
    
</head>
<body>
    <div class="popup" id="popup">
        <span>Public key copied to clipboard</span>
    </div>
    <div class="container">
        <div class="box">
            <div class="header-section">
                <div class="text-content">
                    <div id="name-container">
                        <h1><span class="username">@jackokeeffe</span> / <span class="username">@jckokeeffe</span></h1>
                    </div>
                    <p>interested in filmmaking, business, & technology.</p>
                </div>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 50px;">
                <div class="location">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>canada</span>
                </div>
                <div class="social-icons">
                    <a href="mailto:jokeeffe@protonmail.ch" class="social-icon" data-tooltip="Email"><i class="fas fa-envelope"></i></a>
                    <a href="publickey.asc" class="social-icon" download data-tooltip="pgp Key"><i class="fas fa-lock"></i></a>
                    <a href="https://signal.me/#eu/ms-M2LoXagbi6mPKBM0GxOCAbldVhffKDVer4HxtZDzJ4E8bJP5AprBpmd0S5Bxy" class="social-icon" target="_blank" data-tooltip="Signal"><i class="fa-brands fa-signal-messenger"></i></a>
                    <a href="#" class="social-icon" onclick="copyMatrixId()" data-tooltip="Matrix"><img src="images/icons/matrix.svg" alt="Matrix" style="width: 16px; height: 16px;"></a>
                    <a href="#" class="social-icon" onclick="copyNostrKey()" data-tooltip="Nostr"><img src="images/icons/nostr.svg" alt="Nostr" style="width: 16px; height: 16px;"></a>
                    <a href="https://linkedin.com/in/jckokeeffe/" class="social-icon" target="_blank" data-tooltip="LinkedIn"><i class="fab fa-linkedin"></i></a>
                    <a href="https://github.com/jackokeeffe" class="social-icon" target="_blank" data-tooltip="GitHub"><i class="fab fa-github"></i></a>
                    <a href="https://letterboxd.com/jackokeeffe" class="social-icon" target="_blank" data-tooltip="Letterboxd"><i class="fa-brands fa-letterboxd"></i></a>
                </div>
            </div>
            
            <!-- Projects Section -->
            <div class="recent-activity">
                <div class="activity-header-container">
                    <h2 class="activity-header">Projects</h2>
                </div>
                <div class="projects-container">
                    <div class="project-item">
                        <div class="project-header">
                            <div class="project-icon">
                                <i class="fas fa-film"></i>
                            </div>
                            <h3 class="project-title">PROOFOFCONCEPT</h3>
                        </div>
                        <p class="project-description">a studio integrating technology with film, making media for the next generation.</p>
                        <div class="project-links">
                            <a href="https://proof-of-concept.ca" class="project-link" target="_blank">
                                <i class="fas fa-external-link-alt"></i>
                                View Homepage
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Activity Section -->
            <div class="recent-activity">
                <div class="activity-header-container">
                    <h2 class="activity-header">Recent Activity</h2>
                    <div class="activity-buttons">
                        <button id="refresh-button" onclick="refreshActivity()" title="Refresh activity data">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div id="activity-container">
                    <div class="activity-loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Loading recent activity...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function copyNostrKey() {
            const nostrKey = 'npub17reuqeddvdxuh6m0v8q53kk57n3a69su8m8x50u5ucu2qf8zj52qfls7nf';
            
            // Copy to clipboard
            navigator.clipboard.writeText(nostrKey).then(function() {
                // Show popup
                showPopup('Nostr public key copied to clipboard');
            }).catch(function(err) {
                // Silent error handling
            });
        }

        function copyMatrixId() {
            const matrixId = '@jackokeeffe:matrix.org';
            
            // Copy to clipboard
            navigator.clipboard.writeText(matrixId).then(function() {
                // Show popup
                showPopup('Matrix ID copied to clipboard');
            }).catch(function(err) {
                // Silent error handling
            });
        }

        function showPopup(message) {
            const popup = document.getElementById('popup');
            popup.querySelector('span').textContent = message;
            popup.classList.add('show');
            
            // Hide popup after 3 seconds
            setTimeout(function() {
                popup.classList.remove('show');
            }, 3000);
        }
        
        function refreshActivity() {
            const refreshButton = document.getElementById('refresh-button');
            const icon = refreshButton.querySelector('i');
            
            // Add spinning animation
            icon.classList.add('fa-spin');
            refreshButton.disabled = true;
            
            // Force refresh all activity data
            loadAllActivity(true).finally(() => {
                // Remove spinning animation
                icon.classList.remove('fa-spin');
                refreshButton.disabled = false;
            });
        }
        
        async function loadAllActivity(forceRefresh = false) {
            const container = document.getElementById('activity-container');
            
            try {
                const [githubEvents, nostrPosts, letterboxdActivity] = await Promise.allSettled([
                    loadGitHubActivity(),
                    loadNostrActivity(),
                    loadLetterboxdActivity(forceRefresh)
                ]);
                
                const allActivities = [];
                
                if (githubEvents.status === 'fulfilled' && githubEvents.value) {
                    allActivities.push(...githubEvents.value);
                }
                
                if (nostrPosts.status === 'fulfilled' && nostrPosts.value) {
                    allActivities.push(...nostrPosts.value);
                }
                
                if (letterboxdActivity.status === 'fulfilled' && letterboxdActivity.value) {
                    allActivities.push(...letterboxdActivity.value);
                }
                
                allActivities.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                displayAllActivities(allActivities);
                
            } catch (error) {
                container.innerHTML = `
                    <div class="activity-error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Unable to load recent activity</span>
                    </div>
                `;
            }
        }

        async function loadGitHubActivity() {
            try {
                const response = await fetch('https://api.github.com/users/jackokeeffe/events?per_page=8');
                
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }
                
                const events = await response.json();
                return events.map(event => ({
                    ...event,
                    platform: 'github'
                }));
                
            } catch (error) {
                return [];
            }
        }

        async function loadNostrActivity() {
            try {
                const pubkey = 'npub17reuqeddvdxuh6m0v8q53kk57n3a69su8m8x50u5ucu2qf8zj52qfls7nf';
                let hexPubkey;
                try {
                    hexPubkey = window.NostrTools.nip19.decode(pubkey).data;
                } catch (e) {
                    return [];
                }
                
                const relays = [
                    'wss://relay.nostr.band',
                    'wss://relay.damus.io',
                    'wss://relay.snort.social',
                    'wss://nostr.wine',
                    'wss://nostr.mom',
                    'wss://nos.lol'
                ];
                
                const pool = new window.NostrTools.SimplePool();
                const filter = {
                    kinds: [1],
                    authors: [hexPubkey],
                    limit: 5
                };
                
                let events = [];
                try {
                    const timeoutPromise = new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Relay timeout')), 10000)
                    );
                    
                    let fetchPromise;
                    if (typeof pool.get === 'function') {
                        fetchPromise = pool.get(relays, filter);
                    } else if (typeof pool.list === 'function') {
                        fetchPromise = pool.list(relays, [filter]);
                    } else if (typeof pool.query === 'function') {
                        fetchPromise = pool.query(relays, filter);
                    } else {
                        throw new Error('No valid pool method found');
                    }
                    
                    events = await Promise.race([fetchPromise, timeoutPromise]);
                } catch (e) {
                    return [];
                }
                
                let eventsArray = [];
                if (Array.isArray(events)) {
                    eventsArray = events;
                } else if (events && typeof events === 'object') {
                    eventsArray = [events];
                }
                
                eventsArray.sort((a, b) => b.created_at - a.created_at);
                
                const nostrPosts = eventsArray.map(ev => ({
                        type: 'NostrNote',
                        created_at: new Date(ev.created_at * 1000).toISOString(),
                        payload: {
                            content: ev.content,
                            id: ev.id,
                            link: `https://nostr.band/n/${ev.id}`
                        },
                        platform: 'nostr'
                }));
                
                pool.close(relays);
                return nostrPosts;
            } catch (error) {
                return [];
            }
        }

        function clearLetterboxdCache() {
            localStorage.removeItem('letterboxd_cache');
        }
        
        async function loadLetterboxdActivity(forceRefresh = false) {
            if (forceRefresh) {
                clearLetterboxdCache();
            }
            
            const getCachedData = () => {
                try {
                    const cached = localStorage.getItem('letterboxd_cache');
                    if (cached) {
                        const parsed = JSON.parse(cached);
                        if (Date.now() - parsed.timestamp < 1800000) {
                            return parsed.activities || [];
                        }
                    }
                } catch (e) {}
                                    return null;
            };

            const cached = getCachedData();
            if (cached && !forceRefresh) {
                return cached;
            }

            try {
                const rssUrl = 'https://letterboxd.com/jackokeeffe/rss/';
                const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}&count=10`;
                
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('API error');
                
                const data = await response.json();
                if (data.status !== 'ok' || !data.items || data.items.length === 0) {
                    return cached || [];
                }
                
                const activities = data.items.map(item => {
                    const movieInfo = parseLetterboxdTitle(item.title);
                    return {
                        type: 'LetterboxdActivity',
                        created_at: new Date(item.pubDate).toISOString(),
                        payload: {
                            title: item.title,
                            link: item.link,
                            movieTitle: movieInfo.title,
                            year: movieInfo.year
                        },
                        platform: 'letterboxd'
                    };
                }).filter(a => a.payload.movieTitle);
                
                if (activities.length > 0) {
                    try {
                        localStorage.setItem('letterboxd_cache', JSON.stringify({
                            activities: activities,
                            timestamp: Date.now()
                        }));
                    } catch (e) {}
                }
                
                return activities;
            } catch (error) {
                return cached || [];
            }
        }

        function parseLetterboxdTitle(title) {
            const result = {
                title: '',
                year: '',
                rating: 0,
                activityType: 'watched'
            };
            
            const yearMatch = title.match(/, (\d{4})/);
            if (yearMatch) {
                result.year = yearMatch[1];
                let cleanTitle = title.substring(0, title.indexOf(', ' + yearMatch[1]));
                cleanTitle = cleanTitle.replace(/\s*-\s*[★☆]+.*$/, '');
                result.title = cleanTitle.trim();
            } else {
                let cleanTitle = title.replace(/\s*-\s*[★☆]+.*$/, '');
                result.title = cleanTitle.trim();
            }
            
            return result;
        }

        let allActivities = [];
        let currentDisplayCount = 4;

        function displayAllActivities(activities) {
            const container = document.getElementById('activity-container');
            
            // Store all activities globally
            allActivities = activities || [];
            
            if (!allActivities || allActivities.length === 0) {
                container.innerHTML = `
                    <div class="activity-empty">
                        <i class="fas fa-inbox"></i>
                        <span>No recent activity found</span>
                    </div>
                `;
                return;
            }

            // Reset display count to initial state
            currentDisplayCount = 4;
            
            // Display activities with load more functionality
            displayActivitiesWithLoadMore();
        }

        function displayActivitiesWithLoadMore() {
            const container = document.getElementById('activity-container');
            
            const filteredActivities = allActivities.filter(activity => isDisplayableActivity(activity));
            
            if (filteredActivities.length === 0) {
                container.innerHTML = `
                    <div class="activity-empty">
                        <i class="fas fa-inbox"></i>
                        <span>No recent activity found</span>
                    </div>
                `;
                return;
            }

            // Get activities to display (either 4 or 8 based on current state)
            const activitiesToShow = filteredActivities.slice(0, currentDisplayCount);
            
            // Create HTML for activities
            const activityHTML = activitiesToShow
                .map(activity => createActivityHTML(activity))
                .join('');

            // Add load more button if there are more activities to show
            let loadMoreButton = '';
            if (currentDisplayCount === 4 && filteredActivities.length > 4) {
                loadMoreButton = `
                    <div class="load-more-container">
                        <button id="load-more-button" onclick="loadMoreActivities()" class="load-more-button">
                            <i class="fas fa-chevron-down"></i>
                            Load More
                        </button>
                    </div>
                `;
            }

            container.innerHTML = activityHTML + loadMoreButton;
        }

        function loadMoreActivities() {
            currentDisplayCount = 8;
            displayActivitiesWithLoadMore();
        }

        function isDisplayableActivity(activity) {
            if (activity.platform === 'github') {
                const displayableTypes = ['PushEvent', 'CreateEvent', 'WatchEvent', 'ForkEvent', 'PullRequestEvent', 'IssuesEvent', 'CommitCommentEvent'];
                return displayableTypes.includes(activity.type);
            } else if (activity.platform === 'nostr') {
                return activity.type === 'NostrNote';
            } else if (activity.platform === 'letterboxd') {
                return activity.type === 'LetterboxdActivity';
            }
            return false;
        }

        function createActivityHTML(activity) {
            const { icon, description, link, time, platform, platformLink } = parseActivity(activity);
            
            return `
                <div class="activity-item">
                    <div class="activity-icon">
                        ${icon === 'nostr-svg' ? '<img src="nostr.svg" alt="Nostr" style="width: 14px; height: 14px;">' : `<i class="${icon}"></i>`}
                    </div>
                    <div class="activity-content">
                        <div class="activity-description">${description}</div>
                        ${link ? `<a href="${link}" class="activity-repo" target="_blank">View post</a>` : ''}
                        <div class="activity-time">${time}</div>
                    </div>
                    <div class="activity-platform">
                        ${platformLink ? `<a href="${platformLink}" target="_blank" title="View profile">` : ''}
                        ${platform === 'github' ? '<i class="fab fa-github"></i>' : 
                          platform === 'nostr' ? '<img src="nostr.svg" alt="Nostr" style="width: 12px; height: 12px;">' :
                          platform === 'letterboxd' ? '<i class="fa-brands fa-letterboxd"></i>' : 
                          '<i class="fas fa-bolt"></i>'}
                        ${platformLink ? '</a>' : ''}
                    </div>
                </div>
            `;
        }

        function parseActivity(activity) {
            if (activity.platform === 'github') {
                return parseGitHubEvent(activity);
            } else if (activity.platform === 'nostr') {
                return parseNostrNote(activity);
            } else if (activity.platform === 'letterboxd') {
                return parseLetterboxdActivity(activity);
            }
            return {
                icon: 'fas fa-circle',
                description: 'Unknown activity',
                link: null,
                time: 'Unknown time',
                platform: 'unknown'
            };
        }

        function parseGitHubEvent(event) {
            const time = formatRelativeTime(new Date(event.created_at));
            
            switch (event.type) {
                case 'PushEvent':
                    return {
                        icon: 'fas fa-code-branch',
                        description: `Pushed commit${event.payload.commits?.length !== 1 ? 's' : ''} to ${event.repo.name}`,
                        link: `https://github.com/${event.repo.name}`,
                        time,
                        platform: 'github',
                        platformLink: 'https://github.com/jackokeeffe'
                    };
                
                case 'CreateEvent':
                    const createType = event.payload.ref_type === 'repository' ? 'repository' : 
                                     event.payload.ref_type === 'branch' ? 'branch' : 
                                     event.payload.ref_type === 'tag' ? 'tag' : 'resource';
                    return {
                        icon: 'fas fa-plus',
                        description: `Created ${createType} ${event.payload.ref || event.repo.name}`,
                        link: `https://github.com/${event.repo.name}`,
                        time,
                        platform: 'github',
                        platformLink: 'https://github.com/jackokeeffe'
                    };
                
                case 'WatchEvent':
                    return {
                        icon: 'fas fa-star',
                        description: `Starred ${event.repo.name}`,
                        link: `https://github.com/${event.repo.name}`,
                        time,
                        platform: 'github',
                        platformLink: 'https://github.com/jackokeeffe'
                    };
                
                case 'ForkEvent':
                    return {
                        icon: 'fas fa-code-fork',
                        description: `Forked ${event.repo.name}`,
                        link: `https://github.com/${event.repo.name}`,
                        time,
                        platform: 'github',
                        platformLink: 'https://github.com/jackokeeffe'
                    };
                
                case 'PullRequestEvent':
                    const action = event.payload.action;
                    const prTitle = event.payload.pull_request?.title || 'pull request';
                    return {
                        icon: 'fas fa-pull-request',
                        description: `${action.charAt(0).toUpperCase() + action.slice(1)} pull request: ${prTitle}`,
                        link: `https://github.com/${event.repo.name}`,
                        time,
                        platform: 'github',
                        platformLink: 'https://github.com/jackokeeffe'
                    };
                
                case 'IssuesEvent':
                    const issueAction = event.payload.action;
                    const issueTitle = event.payload.issue?.title || 'issue';
                    return {
                        icon: 'fas fa-exclamation-circle',
                        description: `${issueAction.charAt(0).toUpperCase() + issueAction.slice(1)} issue: ${issueTitle}`,
                        link: `https://github.com/${event.repo.name}`,
                        time,
                        platform: 'github',
                        platformLink: 'https://github.com/jackokeeffe'
                    };
                
                case 'CommitCommentEvent':
                    return {
                        icon: 'fas fa-comment',
                        description: `Commented on commit in ${event.repo.name}`,
                        link: `https://github.com/${event.repo.name}`,
                        time,
                        platform: 'github',
                        platformLink: 'https://github.com/jackokeeffe'
                    };
                
                default:
                    return {
                        icon: 'fas fa-circle',
                        description: `Activity in ${event.repo.name}`,
                        link: `https://github.com/${event.repo.name}`,
                        time,
                        platform: 'github',
                        platformLink: 'https://github.com/jackokeeffe'
                    };
            }
        }

        function parseNostrNote(note) {
            const time = formatRelativeTime(new Date(note.created_at));
            const content = note.payload.content || 'Nostr note';
            
            // Clean up the content (remove URLs and format nicely)
            const cleanContent = content
                .replace(/https?:\/\/[^\s]+/g, '') // Remove URLs
                .replace(/\s+/g, ' ') // Normalize whitespace
                .trim();
            
            // If content is still empty or just whitespace, use a default
            const finalContent = cleanContent || 'Posted on Nostr';
            
            return {
                icon: 'nostr-svg',
                description: finalContent.length > 100 ? finalContent.substring(0, 100) + '...' : finalContent,
                link: note.payload.link,
                time,
                platform: 'nostr',
                platformLink: null // Nostr doesn't have a traditional profile URL
            };
        }

        function parseLetterboxdActivity(activity) {
            const time = formatRelativeTime(new Date(activity.created_at));
            let movieTitle = activity.payload.movieTitle || 'Unknown movie';
            const year = activity.payload.year;
            
            // Remove year from title if it's already there (e.g., "Movie, 2021" -> "Movie")
            if (year) {
                const yearPattern = new RegExp(`,\\s*${year}\\s*$`);
                movieTitle = movieTitle.replace(yearPattern, '').trim();
            }
            
            let description = `Watched - ${movieTitle}`;
            if (year) {
                description += `, ${year}`;
            }
            
            return {
                icon: 'fa-brands fa-letterboxd',
                description: description,
                link: activity.payload.link,
                time,
                platform: 'letterboxd',
                platformLink: 'https://letterboxd.com/jackokeeffe'
            };
        }

        function formatRelativeTime(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} minute${Math.floor(diffInSeconds / 60) !== 1 ? 's' : ''} ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} hour${Math.floor(diffInSeconds / 3600) !== 1 ? 's' : ''} ago`;
            if (diffInSeconds < 2592000) return `${Math.floor(diffInSeconds / 86400)} day${Math.floor(diffInSeconds / 86400) !== 1 ? 's' : ''} ago`;
            if (diffInSeconds < 31536000) return `${Math.floor(diffInSeconds / 2592000)} month${Math.floor(diffInSeconds / 2592000) !== 1 ? 's' : ''} ago`;
            return `${Math.floor(diffInSeconds / 31536000)} year${Math.floor(diffInSeconds / 31536000) !== 1 ? 's' : ''} ago`;
        }

        // Load all activity when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadAllActivity();
        });
    </script>
</body>
</html>
